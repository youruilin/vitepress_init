#1. 模板语法 - 数据绑定

## 1.1 数据绑定的 基本原则

① 在 data 中定义数据
② 在 WXML 中

## 1.2 在data中定义页面的数据

像这样：

```js
Page({
  data: {
    // 字符串类型的数据
    info：'init data',
    // 数组类型的数据
    msgList: [{msg: 'hello'}, {msg: 'world'}]
  }
})
```

## 1.3 Mustache 语法的格式

把data 中的数据绑定到页面中渲染，使用 Mustache 语法 （双大括号）将变量包起来即可。

## 1.4 Mustache 语法的应用场景

- 绑定内容
- 绑定属性
- 运算（包括三元运算、算数运算符）

### 1.4.1 动态绑定内容

页面的数据如下：

```js
Page({
  data: {
    // 字符串类型的数据
    info：'init data',
    // 数组类型的数据
    msgList: [{msg: 'hello'}, {msg: 'world'}]
  }
})
```

结构为：

```html
<image src="{{ imgSrc }}"></image>
```

### 1.4.2 三元运算

页面的数据如下：

```js
Page({
  data: {
    randomNum: Math.random() * 10 // 生成10以内的随机数
  }
})
```

结构为：

```html
<view> {{ randomNum >= 5 ? '随机数字 >= 5' : '随机数字 < 5' }} </view>
```

### 1.4.2 算数运算

页面的数据如下：

```js
Page({
  data: {
    randomNum: Math.random().toFixed(2) // 生成一个带两位小数的随机数
  }
})
```

结构为：

```html
<view>生成100以内的随机数 {{ randomNum * 100 }} </view>
```



## 1.5 事件绑定

事件是 渲染层到逻辑层的通讯方式 。通过事件可以将用户在渲染层产生的行为，反馈到逻辑层进行业务的处理。

![image-20250717230415794](../../../public\image-事件绑定.png)

### 1.5.1小程序中常用的事件

|     **事件类型**     |    **事件名称**     |                         **触发时机**                         |         **备注**         |
| :------------------: | :-----------------: | :----------------------------------------------------------: | :----------------------: |
|  **`tap` 点击事件**  |      `bindtap`      |                       点击事件（冒泡）                       |     最常用的点击事件     |
|                      |     `catchtap`      |                     点击事件（阻止冒泡）                     |   需阻止事件冒泡时使用   |
|                      |   `bindlongpress`   |                           长按事件                           |     长按触发（冒泡）     |
|                      |  `catchlongpress`   |                     长按事件（阻止冒泡）                     |   需阻止事件冒泡时使用   |
| **`touch` 触摸事件** |  `bindtouchstart`   |                           触摸开始                           |       触摸交互相关       |
|                      |   `bindtouchmove`   |                           触摸移动                           |       触摸交互相关       |
|                      |   `bindtouchend`    |                           触摸结束                           |       触摸交互相关       |
|                      |  `bindtouchcancel`  |                 触摸取消（如被其他事件打断）                 |                          |
|     **表单事件**     |     `bindinput`     |                      输入框内容实时变化                      |     实时监听输入内容     |
|                      |    `bindchange`     |               输入框内容变化（失去焦点时触发）               |        非实时监听        |
|                      |     `bindfocus`     |                        输入框获取焦点                        |                          |
|                      |     `bindblur`      |                        输入框失去焦点                        |                          |
|                      |    `bindsubmit`     |                           表单提交                           | 需在 `<form>` 组件上绑定 |
|   **页面生命周期**   |      `onLoad`       |           页面加载时触发（接收页面参数 `options`）           |     页面初始化时调用     |
|                      |      `onShow`       |            页面显示时触发（每次打开页面都会调用）            |                          |
|                      |      `onReady`      |               页面初次渲染完成时触发（仅一次）               |                          |
|                      |      `onHide`       |              页面隐藏时触发（如跳转到其他页面）              |                          |
|                      |     `onUnload`      | 页面卸载时触发（如 `redirectTo` 或 `navigateBack` 关闭页面） |                          |
|                      | `onPullDownRefresh` | 下拉刷新时触发（需在页面配置中启用 `enablePullDownRefresh`） |       下拉刷新功能       |
|                      |   `onReachBottom`   |       上拉触底时触发（需配置 `onReachBottomDistance`）       |     上拉加载更多功能     |
|                      |   `onPageScroll`    |         页面滚动时触发（可获取滚动位置 `scrollTop`）         |         滚动监听         |

------

**事件类型说明**：

1. **`tap` 点击事件**
   - 包括普通点击 (`bindtap`/`catchtap`) 和长按 (`bindlongpress`/`catchlongpress`)。
   - `catch` 前缀会阻止事件冒泡到父组件。
2. **`touch` 触摸事件**
   - 用于更精细的触摸交互（如滑动、拖拽等）。
   - 通常需要结合坐标计算实现自定义手势。
3. **表单事件**
   - 监听输入框或表单的交互行为。
   - `bindinput` 适合实时搜索，`bindchange` 适合最终提交验证。
4. **页面生命周期事件**
   - 控制页面加载、显示、隐藏等状态。
   - `onPullDownRefresh` 和 `onReachBottom` 需在页面配置中启用。

### 1.5.2 事件对象的属性列表

当事件回调触发的时候，会收到一个事件对象 event ，它的详细属性如下表所示：

|   **属性类别**   |                **属性名**                 | **类型** |                           **说明**                           |          **适用场景**          |
| :--------------: | :---------------------------------------: | :------: | :----------------------------------------------------------: | :----------------------------: |
|   **基础属性**   |                  `type`                   |  string  |               事件类型（如 `tap`、`input` 等）               |            所有事件            |
|                  |                `timeStamp`                |  number  |               事件生成时的时间戳（单位：毫秒）               |       性能分析、事件计时       |
|                  |                 `target`                  |  object  |                触发事件的组件的一些属性值集合                |           区分事件源           |
|                  |              `currentTarget`              |  object  |       当前组件的一些属性值集合（可能不同于 `target`）        |     事件冒泡时区分当前组件     |
| **触摸事件特有** |                 `touches`                 |  array   |              当前停留在屏幕上的触摸点信息的数组              |   `touchstart`/`move`/`end`    |
|                  |             `changedTouches`              |  array   | 触摸事件中发生变化的触摸点信息的数组（如从无到有、位置变化等） |   `touchstart`/`move`/`end`    |
| **表单事件特有** |                 `detail`                  |  object  | 额外的信息（如 `input` 事件的输入值、`scroll` 事件的滚动位置等） | `input`/`scroll`/`form` 等事件 |
|  **自定义数据**  |                 `dataset`                 |  object  |      事件源组件上由 `data-` 开头的自定义属性组成的对象       |     所有事件（组件间通信）     |
|     **其他**     | `touches[0].clientX` `touches[0].clientY` |  number  |                触摸点的客户端屏幕坐标（X/Y）                 |        精确触摸位置计算        |
|                  |   `touches[0].pageX` `touches[0].pageY`   |  number  |             触摸点的页面坐标（含滚动偏移，X/Y）              |     考虑页面滚动的触摸位置     |
|                  |           `detail.x` `detail.y`           |  number  |            某些事件（如 `scroll`）的滚动位置坐标             |            滚动事件            |

------

### **关键属性详解**：

#### 1. **`target` vs `currentTarget`**

- **`target`**：触发事件的**最深层组件**（如嵌套组件中实际被点击的子组件）。

- 

  `currentTarget`

  ：当前正在处理事件的

  组件

  （可能是父组件，如果事件冒泡）。

  ```
  <!-- 示例：父组件绑定 tap 事件，子组件被点击 -->
  <view bindtap="handleTap">
    <button>点击我</button> <!-- target 是 button，currentTarget 是 view -->
  </view>
  ```

#### 2. **`dataset`（自定义数据传递）**

- 通过

   

  ```
  data-*
  ```

  属性设置，事件回调中通过

  ```
  event.currentTarget.dataset 
  ```

  获取：

  ```
  <button data-id="123" bindtap="handleBtn">按钮</button>
  ```

  ```
  handleBtn(e) {
    console.log(e.currentTarget.dataset.id); // 输出 "123"
  }
  ```

#### 3. **触摸事件属性**

- **`touches`**：当前所有触摸点的数组（多指触控时可能有多个点）。

- `changedTouches`：本次事件中变化的触摸点（如手指按下或抬起时的点）。

  ```
  handleTouchMove(e) {
    const touch = e.touches[0]; // 第一个触摸点
    console.log(touch.clientX, touch.clientY); // 实时坐标
  }
  ```

#### 4. **表单事件 `detail`**

- **`input` 事件**：`detail.value` 为输入框当前值。

- `scroll` 事件：

  ```
  detail.scrollTop
  ```

  为垂直滚动位置：

  ```
  handleInput(e) {
    console.log(e.detail.value); // 输入内容
  }
  ```

------

### **完整示例**：

```
<view 
  data-type="demo" 
  bindtap="handleTap"
  style="width: 100px; height: 100px; background: red;"
>
  点击我
</view>
Page({
  handleTap(e) {
    console.log(e.type);          // "tap"
    console.log(e.timeStamp);     // 时间戳
    console.log(e.target);        // 被点击的 view 组件信息
    console.log(e.currentTarget); // 当前处理事件的 view 组件信息（此处与 target 相同）
    console.log(e.currentTarget.dataset.type); // "demo"（自定义数据）
  }
});
```

------

### **注意事项**：

1. 不同事件类型的 `event` 对象可能包含**额外专属属性**（如 `scroll` 事件的 `scrollLeft`）。
2. 触摸事件在小程序中通常需要结合 `touches` 和 `changedTouches` 实现复杂手势（如滑动、缩放）。
3. 开发者工具中可通过 `console.log(event)` 查看完整的事件对象结构。

如果需要特定事件（如 `scroll-view` 或 `swiper`）的详细属性，可以进一步补充！

### 1.5.3 binddata 在小程序中，不存在 中的 onclick
